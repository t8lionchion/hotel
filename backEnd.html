<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>backEnd</title>
  <link rel="stylesheet" href="css/styles_BK.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
  

</head>
<body>
<main>
    <div class="container-fluid ">
        <div class="row ">
          <!--左邊菜單  -->
          <div class="col-2 p-0 ">
            <div class="container text-center p-0">
              <div class="row vh-100  flex-column  justify-content-center m-0 ">
                <div class="col-4 p-3 p-0 h-0 d-flex">
                      <a class="navbar-brand m-0 p-0 main-logo  ms-5" href="/backEnd.html">管理後臺</a>
                </div>
                <div class="col-8 m-0 p-3 h-75">
                  <nav class="navbar navbar-expand-lg  justify-content-start my-5 ms-5">
                    <ul class="navbar-nav flex-column align-items-start justify-content-start gap-5 my-5">
                      <li class="nav-item  "><a href="/backEnd_room.html" class="my-2 py-3 description text-decoration-none">房間管理</a></li> 
                      <li class="nav-item  "><a href="/backEnd_order.html" class="my-2 py-3 description text-decoration-none">訂單管理</a></li> 
                     
                      <li class="nav-item  "><a href="/backEnd_custmer.html" class="my-2 py-3 description text-decoration-none">顧客管理</a></li> 
                      <li class="nav-item  "><a href="/backEnd_report.html" class="my-2 py-3 description text-decoration-none">營業報表</a></li> 
                    </ul>
                  </nav> 
                </div>
              </div>
            </div>
          </div>
          <!-- 右邊版面 -->
          <div class="col-10 ps-5">
            <div class="container-fluid d-flex justify-content-between my-3 p-0 border-bottom-ST">
                <div class="col-6 m-0 p-0 d-flex align-items-center">
                  <h1 class=" m-0 p-0 main-logo">Dashboard 管理後台</h1>
                </div>
                <div class="col-6 m-0 p-0 ">
                  <div class="d-flex align-items-center justify-content-end  me-3">                  
                    <span class="m-0 text-light">將在</span>
                    <span class="m-0 text-light" id="autoLogout">15:00</span>
                    <span class="m-0 text-light mx-2">後自動登出</span>
                    <button class="btn btn-outline-light mx-2" onclick="logout()">登出</button>
                  </div>
                </div>
             </div>

            <div class="">
              <div class="row">
                <div class="col-6 mb-5">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title border-bottom">今日資訊</h5>
                      <table class="table">
                        <tbody>
                          <tr>
                            <th>入住筆數</th>
                            <td id="check_in_count">---</td>
                          </tr>
                          <tr>
                            <th>退房筆數</th>
                            <td id="check_out_count">---</td>
                          </tr>
                          <tr>
                            <th>未付款訂單</th>
                            <td id="unpaid">---</td>
                          </tr>
                        </tbody>
                      </table>
                     
                    </div>
                  </div>
                </div>
                <div class="col-3 offset-1">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title border-bottom text-center fs-5">即將入住提醒</h5>
                      <table class="table">
                        <tbody>
                          <tr>
                            <!-- <th>預計抵達時間</th> -->
                            <th>房型編號</th>
                            <th>人數</th>
                          </tr>
                          <tr>
                            <!-- <td>2025-07-06 16:00</td> -->
                            <td id="coming_soon_room">---</td>
                            <td id="coming_soon_count">---</td>
                          </tr>

                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
                <!-- <div class="col-6 mb-5">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title  border-bottom">房間狀況</h5>
                      <table class="table">
                        <tbody>
                          <tr>
                            <th>可用房間數</th>
                            <td id="available_rooms">---</td>
                          </tr>
                          <tr>
                            <th>預約房間數</th>
                            <td id="booked_rooms">---</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div> -->
              </div>
            </div>

             
          </div>
        </div>
    </div>
</main>

<script src="bk_script.js"></script>
<script> 
async function get_data() {
  const response = await fetch('/api/backend/today_check')
  const data = await response.json()
  let check_in_count = data.length;
  let check_out_count = 0;
  let payment_date_count = 0;


  data.forEach(item => {
  const utcString = item.check_out;
  const date = new Date(utcString);  // 自動轉為本地時間
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const formattedDate = `${year}-${month}-${day}`;
  if(formattedDate == new Date().toISOString().split('T')[0]){
    check_out_count++;
  }
  count = item.payment_date;
  if(count != null){
    payment_date_count++;
  }
})
document.getElementById('check_in_count').textContent = check_in_count;
document.getElementById('check_out_count').textContent = check_out_count;
document.getElementById('unpaid').textContent = payment_date_count;
}
get_data()


console.log('--------------')
//--即將入住---------------------------------- 
async function coming_soon() {
  const response = await fetch('/api/backend/coming_soon')
  const data = await response.json()
document.getElementById('coming_soon_room').textContent = data[0].room_type_id;
document.getElementById('coming_soon_count').textContent = data[0].total_guests;
}
coming_soon()

//--房間狀況---------------------
// async function room_check() {
//   const response = await fetch('/api/backend/room_check')
//   const data = await response.json()
//   document.getElementById('available_rooms').textContent = data[0].available_rooms;
//   document.getElementById('booked_rooms').textContent = data[0].available_rooms-data[0].check_in;
// }
// room_check()


</script>
</body>
</html>
